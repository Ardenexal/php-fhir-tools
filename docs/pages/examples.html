---
layout: docs
title: Examples
permalink: /pages/examples/
---

<div class="examples-page">
    <h1>Code Examples</h1>
    <p class="lead">Practical examples demonstrating PHP FHIRTools capabilities with real FHIR resources.</p>

    <!-- Example Browser Section -->
    <section class="example-browser">
        <h2>Interactive Example Browser</h2>
        <p>Browse and explore production-ready FHIR R4 resources. Click an example to view the JSON structure.</p>
        
        <div class="example-selector">
            <button class="example-btn" onclick="loadExample('patient-simple.json')">Simple Patient</button>
            <button class="example-btn" onclick="loadExample('patient-complex.json')">Complex Patient</button>
            <button class="example-btn" onclick="loadExample('observation-vital-signs.json')">Vital Signs</button>
            <button class="example-btn" onclick="loadExample('bundle-transaction.json')">Transaction Bundle</button>
            <button class="example-btn" onclick="loadExample('medication-request.json')">Medication Request</button>
            <button class="example-btn" onclick="loadExample('practitioner.json')">Practitioner</button>
        </div>

        <div class="example-display" id="example-display" style="display:none;">
            <div class="example-header">
                <h3 id="example-title">Example Resource</h3>
                <button class="copy-btn" onclick="copyExample()">Copy JSON</button>
            </div>
            <pre><code class="language-json" id="example-json"></code></pre>
        </div>
    </section>

    <!-- Patient Creation Examples -->
    <section class="code-examples">
        <h2>Patient Resource Creation</h2>
        
        <h3>Simple Patient</h3>
        <p>Create a basic patient resource with minimal required fields:</p>
        <pre><code class="language-php">use Ardenexal\FHIRTools\Component\Models\R4\Resource\PatientResource;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\HumanName;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\DatePrimitive;
use Ardenexal\FHIRTools\Component\Models\R4\Type\AdministrativeGenderType;

$patient = new PatientResource(
    id: 'example-simple',
    name: [
        new HumanName(
            family: 'Smith',
            given: ['John'],
        ),
    ],
    gender: new AdministrativeGenderType('male'),
    birthDate: new DatePrimitive(value: '1974-12-25'),
);

// Serialize to JSON
$serializer = new FHIRSerializationService();
$json = $serializer->serializeToJson($patient);
echo $json;</code></pre>

        <h3>Complex Patient with Full Demographics</h3>
        <p>Create a patient with complete demographic information:</p>
        <pre><code class="language-php">use Ardenexal\FHIRTools\Component\Models\R4\DataType\Identifier;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\ContactPoint;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Address;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\UriPrimitive;
use Ardenexal\FHIRTools\Component\Models\R4\Type\IdentifierUseType;
use Ardenexal\FHIRTools\Component\Models\R4\Type\ContactPointSystemType;
use Ardenexal\FHIRTools\Component\Models\R4\Type\ContactPointUseType;
use Ardenexal\FHIRTools\Component\Models\R4\Type\NameUseType;
use Ardenexal\FHIRTools\Component\Models\R4\Type\AddressUseType;

// Build individual data types
$officialName = new HumanName(
    use: new NameUseType('official'),
    family: 'Smith',
    given: ['John', 'Robert'],
    prefix: ['Mr.'],
);

$mrn = new Identifier(
    use: new IdentifierUseType('official'),
    system: new UriPrimitive(value: 'http://hospital.example.org/patients'),
    value: 'MRN-123456',
);

$phone = new ContactPoint(
    system: new ContactPointSystemType('phone'),
    value: '+1-555-123-4567',
    use: new ContactPointUseType('home'),
);

$address = new Address(
    use: new AddressUseType('home'),
    line: ['123 Main St', 'Apt 4B'],
    city: 'Springfield',
    state: 'IL',
    postalCode: '62701',
    country: 'US',
);

// Compose the patient resource
$patient = new PatientResource(
    id: 'example-complex',
    active: true,
    name: [$officialName],
    identifier: [$mrn],
    telecom: [$phone],
    address: [$address],
    gender: new AdministrativeGenderType('male'),
    birthDate: new DatePrimitive(value: '1974-12-25'),
);</code></pre>
    </section>

    <!-- Observation Examples -->
    <section class="code-examples">
        <h2>Observation Creation</h2>
        
        <h3>Blood Pressure Observation</h3>
        <p>Create a vital signs observation with multiple components:</p>
        <pre><code class="language-php">use Ardenexal\FHIRTools\Component\Models\R4\Resource\ObservationResource;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\CodeableConcept;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Coding;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Quantity;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Reference;
use Ardenexal\FHIRTools\Component\Models\R4\Resource\Observation\ObservationComponent;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\UriPrimitive;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\CodePrimitive;
use Ardenexal\FHIRTools\Component\Models\R4\Type\ObservationStatusType;

// Build category
$category = new CodeableConcept(
    coding: [
        new Coding(
            system: new UriPrimitive(value: 'http://terminology.hl7.org/CodeSystem/observation-category'),
            code: new CodePrimitive(value: 'vital-signs'),
            display: 'Vital Signs',
        ),
    ],
);

// Build code (LOINC for Blood Pressure)
$code = new CodeableConcept(
    coding: [
        new Coding(
            system: new UriPrimitive(value: 'http://loinc.org'),
            code: new CodePrimitive(value: '85354-9'),
            display: 'Blood pressure panel',
        ),
    ],
);

// Build systolic component
$systolicValue = new Quantity(
    value: 120,
    unit: 'mmHg',
    system: new UriPrimitive(value: 'http://unitsofmeasure.org'),
    code: new CodePrimitive(value: 'mm[Hg]'),
);

$systolic = new ObservationComponent(
    code: new CodeableConcept(
        coding: [
            new Coding(
                system: new UriPrimitive(value: 'http://loinc.org'),
                code: new CodePrimitive(value: '8480-6'),
                display: 'Systolic blood pressure',
            ),
        ],
    ),
    valueX: $systolicValue,
);

// Build diastolic component
$diastolicValue = new Quantity(
    value: 80,
    unit: 'mmHg',
    system: new UriPrimitive(value: 'http://unitsofmeasure.org'),
    code: new CodePrimitive(value: 'mm[Hg]'),
);

$diastolic = new ObservationComponent(
    code: new CodeableConcept(
        coding: [
            new Coding(
                system: new UriPrimitive(value: 'http://loinc.org'),
                code: new CodePrimitive(value: '8462-4'),
                display: 'Diastolic blood pressure',
            ),
        ],
    ),
    valueX: $diastolicValue,
);

// Compose the observation resource
$observation = new ObservationResource(
    id: 'blood-pressure-example',
    status: new ObservationStatusType('final'),
    category: [$category],
    code: $code,
    subject: new Reference(reference: 'Patient/example-simple'),
    effectiveDateTime: '2024-01-15T10:30:00Z',
    component: [$systolic, $diastolic],
);</code></pre>
    </section>

    <!-- FHIRPath Examples -->
    <section class="code-examples">
        <h2>FHIRPath Evaluation</h2>
        
        <h3>Basic Expression Evaluation</h3>
        <pre><code class="language-php">use Ardenexal\FHIRTools\Component\FHIRPath\Evaluator\FHIRPathEvaluator;

$evaluator = new FHIRPathEvaluator();

// Get patient name
$result = $evaluator->evaluate($patient, 'Patient.name.family');
// Returns: ['Smith']

// Check if patient is active
$result = $evaluator->evaluate($patient, 'Patient.active');
// Returns: [true]

// Get all phone numbers
$result = $evaluator->evaluate($patient, "Patient.telecom.where(system='phone').value");
// Returns: ['+1-555-123-4567']

// Get patient age (if birthDate exists)
$result = $evaluator->evaluate($patient, 'Patient.birthDate.toInteger()');

// Check if email exists
$result = $evaluator->evaluate($patient, "Patient.telecom.where(system='email').exists()");
// Returns: [false]</code></pre>

        <h3>Complex FHIRPath Queries</h3>
        <pre><code class="language-php">// Get all observations with systolic > 140
$result = $evaluator->evaluate($bundle, 
    "Bundle.entry.resource.ofType(Observation)" .
    ".where(component.where(code.coding.code='8480-6').value > 140)"
);

// Get patient names in specific format
$result = $evaluator->evaluate($patient,
    "Patient.name.where(use='official').select(family + ', ' + given.first())"
);
// Returns: ['Smith, John']

// Count number of addresses
$result = $evaluator->evaluate($patient, 'Patient.address.count()');
// Returns: [1]

// Get all identifiers of a specific system
$result = $evaluator->evaluate($patient,
    "Patient.identifier.where(system='http://hospital.example.org/patients').value"
);
// Returns: ['MRN-123456']</code></pre>
    </section>

    <!-- Bundle Examples -->
    <section class="code-examples">
        <h2>Bundle Creation and Processing</h2>
        
        <h3>Create Transaction Bundle</h3>
        <pre><code class="language-php">use Ardenexal\FHIRTools\Component\Models\R4\Resource\BundleResource;
use Ardenexal\FHIRTools\Component\Models\R4\Resource\Bundle\BundleEntry;
use Ardenexal\FHIRTools\Component\Models\R4\Resource\Bundle\BundleEntryRequest;
use Ardenexal\FHIRTools\Component\Models\R4\Type\BundleTypeType;
use Ardenexal\FHIRTools\Component\Models\R4\Type\HTTPVerbType;

// Build patient entry
$patientEntry = new BundleEntry(
    fullUrl: 'urn:uuid:' . $this->generateUuid(),
    resource: $patient,
    request: new BundleEntryRequest(
        method: new HTTPVerbType('POST'),
        url: new UriPrimitive(value: 'Patient'),
    ),
);

// Build observation entry
$observationEntry = new BundleEntry(
    fullUrl: 'urn:uuid:' . $this->generateUuid(),
    resource: $observation,
    request: new BundleEntryRequest(
        method: new HTTPVerbType('POST'),
        url: new UriPrimitive(value: 'Observation'),
    ),
);

// Compose the bundle
$bundle = new BundleResource(
    type: new BundleTypeType('transaction'),
    entry: [$patientEntry, $observationEntry],
);

// Serialize bundle
$json = $serializer->serializeToJson($bundle);</code></pre>

        <h3>Process Bundle Entries</h3>
        <pre><code class="language-php">// Iterate through bundle entries
foreach ($bundle->entry as $entry) {
    $resource = $entry->resource;

    if ($resource instanceof PatientResource) {
        echo "Processing Patient\n";
        $patient = $resource;
        // Process patient
    } elseif ($resource instanceof ObservationResource) {
        echo "Processing Observation\n";
        $observation = $resource;
        // Process observation
    }
}

// Use FHIRPath to filter entries
$patients = $evaluator->evaluate($bundle,
    "Bundle.entry.resource.ofType(Patient)"
);

$observations = $evaluator->evaluate($bundle,
    "Bundle.entry.resource.ofType(Observation)"
);</code></pre>
    </section>

    <!-- Validation Examples -->
    <section class="code-examples">
        <h2>Validation</h2>
        
        <h3>Strict Validation Mode</h3>
        <pre><code class="language-php">use Ardenexal\FHIRTools\Component\Serialization\FHIRSerializationService;
use Ardenexal\FHIRTools\Component\Serialization\ValidationMode;

$serializer = new FHIRSerializationService();

try {
    $patient = $serializer->deserializeFromJson(
        $json,
        PatientResource::class,
        ValidationMode::STRICT
    );
    echo "Validation passed!";
} catch (ValidationException $e) {
    // Get OperationOutcome
    $outcome = $e->getOperationOutcome();

    foreach ($outcome->issue as $issue) {
        echo "Severity: " . $issue->severity . "\n";
        echo "Code: " . $issue->code . "\n";
        echo "Details: " . $issue->details->text . "\n";
        echo "Diagnostics: " . $issue->diagnostics . "\n";

        if ($issue->expression) {
            echo "Location: " . implode(', ', $issue->expression) . "\n";
        }
    }
}</code></pre>

        <h3>Lenient Validation Mode</h3>
        <pre><code class="language-php">// Lenient mode allows some non-critical errors
$patient = $serializer->deserializeFromJson(
    $json,
    PatientResource::class,
    ValidationMode::LENIENT
);

// Check if there were any warnings
if ($serializer->hasWarnings()) {
    $warnings = $serializer->getWarnings();
    foreach ($warnings as $warning) {
        echo "Warning: " . $warning . "\n";
    }
}</code></pre>
    </section>
</div>

<style>
.examples-page {
    max-width: 1200px;
}

.example-browser {
    background: var(--color-gray-50);
    border: 1px solid var(--color-gray-200);
    border-radius: var(--radius-lg);
    padding: var(--spacing-6);
    margin-bottom: var(--spacing-8);
}

.example-selector {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-3);
    margin-bottom: var(--spacing-4);
}

.example-btn {
    padding: var(--spacing-3) var(--spacing-5);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: var(--font-size-sm);
    font-weight: 500;
    transition: var(--transition-base);
}

.example-btn:hover {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
}

.example-display {
    margin-top: var(--spacing-4);
}

.example-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-3);
}

.example-header h3 {
    margin: 0;
}

.copy-btn {
    padding: var(--spacing-2) var(--spacing-4);
    background: var(--color-secondary);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: var(--font-size-sm);
    transition: var(--transition-base);
}

.copy-btn:hover {
    background: var(--color-secondary-dark);
}

.code-examples {
    margin-bottom: var(--spacing-10);
}

.code-examples h2 {
    color: var(--color-primary);
    margin-bottom: var(--spacing-4);
    padding-bottom: var(--spacing-2);
    border-bottom: 2px solid var(--color-primary);
}

.code-examples h3 {
    color: var(--color-gray-800);
    margin-top: var(--spacing-6);
    margin-bottom: var(--spacing-3);
}

.code-examples p {
    color: var(--color-gray-600);
    margin-bottom: var(--spacing-3);
}

.code-examples pre {
    margin-bottom: var(--spacing-6);
}
</style>

<script>
async function loadExample(filename) {
    try {
        const response = await fetch('{{ site.baseurl }}/assets/data/examples/' + filename);
        const data = await response.json();
        
        const display = document.getElementById('example-display');
        const title = document.getElementById('example-title');
        const jsonElement = document.getElementById('example-json');
        
        title.textContent = filename.replace('.json', '').replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        jsonElement.textContent = JSON.stringify(data, null, 2);
        
        display.style.display = 'block';
        
        // Highlight syntax if Prism is available
        if (window.Prism) {
            Prism.highlightElement(jsonElement);
        }
    } catch (error) {
        console.error('Error loading example:', error);
        alert('Failed to load example. Please try again.');
    }
}

function copyExample() {
    const jsonElement = document.getElementById('example-json');
    const text = jsonElement.textContent;
    
    navigator.clipboard.writeText(text).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => {
            btn.textContent = originalText;
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy:', err);
        alert('Failed to copy to clipboard');
    });
}
</script>

<!-- Load Prism.js for syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
