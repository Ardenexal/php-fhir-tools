---
layout: docs
title: Models
category: components
---

# Models

The Models component provides type-safe PHP classes for FHIR resources, data types, and complex elements. All models are generated from official FHIR specifications.

## Overview

Key features:

- **Type-Safe**: Strict PHP types for all properties
- **Multi-Version**: Support for R4, R4B, and R5
- **Auto-Generated**: Generated from official FHIR structure definitions
- **Validated**: Built-in validation rules
- **Serializable**: Works seamlessly with the Serialization component
- **IDE-Friendly**: Full auto-completion support

## Installation

### Standalone

```bash
composer require ardenexal/fhir-models
```

### With FHIRBundle

```bash
composer require ardenexal/fhir-bundle
```

## FHIR Versions

### R4 (4.0.1)

```php
use Ardenexal\FHIRTools\Component\Models\R4\Resource\PatientResource;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\HumanName;

$patient = new PatientResource(id: 'patient-123');
```

### R4B (4.3.0)

```php
use Ardenexal\FHIRTools\Component\Models\R4B\Resource\PatientResource;
use Ardenexal\FHIRTools\Component\Models\R4B\DataType\HumanName;

$patient = new PatientResource(id: 'patient-123');
```

### R5 (5.0.0)

```php
use Ardenexal\FHIRTools\Component\Models\R5\Resource\PatientResource;
use Ardenexal\FHIRTools\Component\Models\R5\DataType\HumanName;

$patient = new PatientResource(id: 'patient-123');
```

## Basic Usage

### Creating a Patient

```php
use Ardenexal\FHIRTools\Component\Models\R4\Resource\PatientResource;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\HumanName;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\ContactPoint;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Address;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\DatePrimitive;
use Ardenexal\FHIRTools\Component\Models\R4\ValueSet\AdministrativeGenderType;
use Ardenexal\FHIRTools\Component\Models\R4\ValueSet\NameUseType;
use Ardenexal\FHIRTools\Component\Models\R4\ValueSet\ContactPointSystemType;
use Ardenexal\FHIRTools\Component\Models\R4\ValueSet\ContactPointUseType;
use Ardenexal\FHIRTools\Component\Models\R4\ValueSet\AddressUseType;

// Create patient with constructor promoted properties
$patient = new PatientResource(
    id: 'patient-123',
    active: true,
    gender: new AdministrativeGenderType('male'),
    birthDate: new DatePrimitive(value: '1980-01-15'),
);

// Add name
$patient->name[] = new HumanName(
    use: new NameUseType('official'),
    family: 'Doe',
    given: ['John', 'Robert'],
);

// Add telecom
$patient->telecom[] = new ContactPoint(
    system: new ContactPointSystemType('phone'),
    value: '+1-555-123-4567',
    use: new ContactPointUseType('home'),
);

$patient->telecom[] = new ContactPoint(
    system: new ContactPointSystemType('email'),
    value: 'john.doe@example.com',
);

// Add address
$patient->address[] = new Address(
    use: new AddressUseType('home'),
    line: ['123 Main St', 'Apt 4B'],
    city: 'Springfield',
    state: 'IL',
    postalCode: '62701',
    country: 'USA',
);
```

### Creating an Observation

```php
use Ardenexal\FHIRTools\Component\Models\R4\Resource\ObservationResource;
use Ardenexal\FHIRTools\Component\Models\R4\Resource\Observation\ObservationComponent;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\CodeableConcept;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Coding;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Quantity;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Reference;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\UriPrimitive;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\CodePrimitive;
use Ardenexal\FHIRTools\Component\Models\R4\ValueSet\ObservationStatusType;

// Build the code (LOINC)
$code = new CodeableConcept(
    coding: [
        new Coding(
            system: new UriPrimitive(value: 'http://loinc.org'),
            code: new CodePrimitive(value: '85354-9'),
            display: 'Blood pressure panel',
        ),
    ],
);

// Build systolic component
$systolicComponent = new ObservationComponent(
    code: new CodeableConcept(
        coding: [
            new Coding(
                system: new UriPrimitive(value: 'http://loinc.org'),
                code: new CodePrimitive(value: '8480-6'),
                display: 'Systolic blood pressure',
            ),
        ],
    ),
    valueX: new Quantity(
        value: 120,
        unit: 'mmHg',
        system: new UriPrimitive(value: 'http://unitsofmeasure.org'),
        code: new CodePrimitive(value: 'mm[Hg]'),
    ),
);

// Build diastolic component
$diastolicComponent = new ObservationComponent(
    code: new CodeableConcept(
        coding: [
            new Coding(
                system: new UriPrimitive(value: 'http://loinc.org'),
                code: new CodePrimitive(value: '8462-4'),
                display: 'Diastolic blood pressure',
            ),
        ],
    ),
    valueX: new Quantity(
        value: 80,
        unit: 'mmHg',
        system: new UriPrimitive(value: 'http://unitsofmeasure.org'),
        code: new CodePrimitive(value: 'mm[Hg]'),
    ),
);

// Create observation with all parts composed together
$observation = new ObservationResource(
    id: 'obs-123',
    status: new ObservationStatusType('final'),
    code: $code,
    subject: new Reference(reference: 'Patient/patient-123'),
    component: [$systolicComponent, $diastolicComponent],
);
```

## Property Access

### Property Access

All model properties are public constructor promoted properties. Read and write them directly:

```php
// Read properties directly
$isActive = $patient->active;   // bool(true)
$gender = $patient->gender;     // AdministrativeGenderType

// Assign properties directly
$patient->active = false;
$patient->id = 'new-id';
```

### Collections

```php
// Add to collections using array push
$patient->name[] = $name1;
$patient->name[] = $name2;

// Read collection directly
$names = $patient->name;  // array of HumanName

// Iterate collection
foreach ($patient->name as $name) {
    echo $name->family . "\n";
}
```

### Nested Properties

```php
// Access nested properties directly
$familyName = $patient->name[0]->family;
$city = $patient->address[0]->city;

// Safe navigation with null checks
$family = $patient->name[0]?->family ?? 'Unknown';
```

## Type Safety

All models use strict types via constructor promoted properties:

```php
declare(strict_types=1);

// Type errors are caught at runtime
$patient = new PatientResource(active: true);       // OK
$patient = new PatientResource(active: 'true');     // TypeError

$patient = new PatientResource(
    birthDate: new DatePrimitive(value: '1980-01-15'),  // OK
);
$patient = new PatientResource(
    birthDate: new \DateTime(),                          // TypeError
);
```

## Validation

Models include built-in validation:

```php
use Ardenexal\FHIRTools\Component\Serialization\Validator\FHIRValidator;

$validator = new FHIRValidator();

// Validate resource
$result = $validator->validate($patient);

if (!$result->isValid()) {
    foreach ($result->getErrors() as $error) {
        echo $error->getMessage() . "\n";
        echo "Path: " . $error->getPath() . "\n";
    }
}
```

## Serialization Integration

Models work seamlessly with the Serialization component:

```php
use Ardenexal\FHIRTools\Component\Serialization\FHIRSerializationService;

$serializer = new FHIRSerializationService();

// Serialize to JSON
$json = $serializer->serialize($patient);

// Deserialize from JSON
$patient = $serializer->deserialize($json, 'Patient');

// The returned object is a fully-typed Patient model
$name = $patient->name[0]->family;  // Type-safe
```

## Resource Types

### Domain Resources

- **Patient**: Demographics and other administrative information
- **Observation**: Measurements and simple assertions
- **Condition**: Detailed information about conditions, problems or diagnoses
- **MedicationRequest**: Order or request for medication
- **Procedure**: An action performed on or to a patient
- **Encounter**: Interaction between patient and healthcare provider
- **DiagnosticReport**: Report of diagnostic tests
- **CarePlan**: Healthcare plan for patient
- And 100+ more...

### Data Types

#### Primitive Types
- string, boolean, integer, decimal
- date, dateTime, time, instant
- uri, url, canonical, oid, uuid
- base64Binary, code, id, markdown

#### Complex Types
- **HumanName**: Name of a person
- **Address**: Postal address
- **ContactPoint**: Phone, email, etc.
- **Identifier**: Business identifier
- **CodeableConcept**: Concept with coding
- **Quantity**: Measured amount
- **Period**: Time period
- **Reference**: Reference to another resource
- **Attachment**: Binary content
- And 40+ more...

## Code Generation

### Generate Models

```php
use Ardenexal\FHIRTools\Component\CodeGeneration\Generator\FHIRModelGenerator;

$generator = new FHIRModelGenerator();

// Generate R4 models
$generator->generate('R4', '/path/to/output/R4');

// Generate R5 models
$generator->generate('R5', '/path/to/output/R5');
```

### Custom Namespaces

```php
$generator->generate('R4', '/path/to/output', [
    'namespace' => 'App\\FHIR\\R4',
    'base_namespace' => 'App\\FHIR'
]);
```

### Symfony Integration

```yaml
# config/packages/fhir.yaml
fhir:
    models:
        cache_directory: '%kernel.cache_dir%/fhir/models'
        auto_generate: false
        namespaces:
            R4: 'App\FHIR\R4'
            R4B: 'App\FHIR\R4B'
            R5: 'App\FHIR\R5'
```

Generate via command:

```bash
php bin/console fhir:generate-models R4
```

## Advanced Usage

### Custom Extensions

```php
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Extension;

// Add extension to patient
$patient->extension[] = new Extension(
    url: 'http://example.org/fhir/StructureDefinition/race',
    valueX: 'Asian',
);

// Access extensions
foreach ($patient->extension as $ext) {
    if ($ext->url === 'http://example.org/fhir/StructureDefinition/race') {
        $race = $ext->valueX;
    }
}
```

### Contained Resources

```php
use Ardenexal\FHIRTools\Component\Models\R4\Resource\PractitionerResource;
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Reference;

// Create contained resource
$practitioner = new PractitionerResource(id: 'pract-1');
// ... set practitioner properties

$observation->contained[] = $practitioner;

// Reference contained resource
$observation->performer[] = new Reference(reference: '#pract-1');
```

### Meta Information

```php
use Ardenexal\FHIRTools\Component\Models\R4\DataType\Meta;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\IdPrimitive;
use Ardenexal\FHIRTools\Component\Models\R4\Primitive\InstantPrimitive;

$patient->meta = new Meta(
    versionId: new IdPrimitive(value: '1'),
    lastUpdated: new InstantPrimitive(value: '2024-01-15T10:30:00Z'),
    profile: ['http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient'],
);
```

## IDE Support

Models provide full IDE auto-completion:

- Property discovery
- Method signatures
- Type hints
- PHPDoc annotations
- Return type declarations

## Performance

### Memory Efficiency

Models are designed for efficiency:

```php
// Create with only the properties you need
$patient = new PatientResource(id: '123');  // Only ID is stored in memory

// Add to collections as needed
$patient->name[] = $name;  // Added to internal array
```

### Cloning

```php
// Deep clone resources
$patientCopy = clone $patient;

// Modify copy without affecting original
$patientCopy->active = false;
```

## Next Steps

- [Serialization Component](serialization.html) - Serialize models to JSON/XML
- [FHIRPath Component](fhirpath.html) - Query model properties
- [Validation Component](validation.html) - Validate models (coming soon)
- [API Reference](../api-reference.html) - Complete API documentation

## Resources

- [FHIR R4 Resources](https://www.hl7.org/fhir/R4/resourcelist.html)
- [FHIR R5 Resources](https://www.hl7.org/fhir/R5/resourcelist.html)
- [FHIR Data Types](https://www.hl7.org/fhir/datatypes.html)
- [GitHub Repository](https://github.com/Ardenexal/php-fhir-tools)
